<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NEXUS 桌球系統</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Teko:wght@300;600&display=swap" rel="stylesheet">

  <style>
    /* --- NEXT-GEN UI 設定 --- */
    :root {
      --cyan: #00f3ff;
      --purple: #bc13fe;
      --dark-bg: #050505;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-main: #ffffff;
      --text-dim: #8b9bb4;
    }

    body {
      font-family: 'Exo 2', sans-serif;
      background-color: var(--dark-bg);
      /* 背景：深邃的徑向漸層，模擬宇宙深處的光 */
      background-image: 
        radial-gradient(circle at 50% 0%, rgba(188, 19, 254, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 0% 100%, rgba(0, 243, 255, 0.15) 0%, transparent 50%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: var(--text-main);
      overflow: hidden;
    }

    /* 背景流動網格 (增加層次感) */
    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(255, 0, 0, 0.02), rgba(255, 0, 0, 0.06));
      background-size: 100% 2px, 3px 100%;
      pointer-events: none;
      z-index: -1;
    }

    /* --- 主卡片：玻璃擬態 --- */
    .card {
      background: var(--glass-bg);
      width: 85%;
      max-width: 380px;
      padding: 40px 30px;
      border-radius: 24px;
      text-align: center;
      /* 邊框發光 */
      border: 1px solid var(--glass-border);
      box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.5),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px); /* 強力模糊 */
      position: relative;
      overflow: hidden;
    }

    /* 卡片頂部的霓虹燈條 */
    .card::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--purple), var(--cyan));
      box-shadow: 0 0 15px var(--cyan);
    }

    h1 {
      margin: 0 0 5px;
      font-weight: 700;
      font-size: 28px;
      letter-spacing: 2px;
      background: linear-gradient(90deg, #fff, var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }

    .sub-text {
      color: var(--text-dim);
      font-size: 12px;
      letter-spacing: 4px; /* 拉寬間距更有科技感 */
      text-transform: uppercase;
      margin-bottom: 30px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 10px;
      display: inline-block;
    }

    /* --- 輸入框：終端機風格 --- */
    input {
      width: 100%;
      padding: 16px;
      font-size: 18px;
      font-family: 'Exo 2', sans-serif;
      color: var(--cyan);
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 243, 255, 0.3);
      border-radius: 8px;
      box-sizing: border-box;
      outline: none;
      margin-bottom: 15px;
      text-align: center;
      transition: 0.3s;
      letter-spacing: 1px;
    }
    input::placeholder { color: rgba(255, 255, 255, 0.2); letter-spacing: 0; }
    input:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
      background: rgba(0, 0, 0, 0.5);
    }

    /* --- 按鈕：霓虹漸層 --- */
    .btn {
      width: 100%;
      padding: 18px;
      font-size: 18px;
      font-weight: 700;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Exo 2', sans-serif;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 15px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
    }
    
    /* 藍紫漸層 */
    .btn-main {
      background: linear-gradient(135deg, var(--purple), #0062ff);
      box-shadow: 0 0 20px rgba(188, 19, 254, 0.4);
    }
    .btn-main:hover {
      box-shadow: 0 0 30px rgba(188, 19, 254, 0.6);
      transform: translateY(-2px);
    }

    /* 簽到按鈕：極致的青色光芒 */
    .btn-action {
      background: transparent;
      border: 1px solid var(--cyan);
      color: var(--cyan);
      box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
    }
    .btn-action:hover {
      background: var(--cyan);
      color: #000;
      box-shadow: 0 0 30px rgba(0, 243, 255, 0.6);
    }

    /* --- 核心：全像投影能量環 --- */
    .holo-ring {
      width: 160px;
      height: 160px;
      margin: 30px auto;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    /* 外圈旋轉光環 */
    .holo-ring::before {
      content: '';
      position: absolute;
      width: 100%; height: 100%;
      border-radius: 50%;
      border: 2px solid transparent;
      border-top-color: var(--cyan);
      border-bottom-color: var(--purple);
      animation: spin 3s linear infinite;
      box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
    }
    /* 內圈靜態裝飾 */
    .holo-ring::after {
      content: '';
      position: absolute;
      width: 85%; height: 85%;
      border-radius: 50%;
      border: 1px dashed rgba(255, 255, 255, 0.2);
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .balance-num {
      font-family: 'Teko', sans-serif; /* 數字專用字體 */
      font-size: 72px;
      line-height: 1;
      color: #fff;
      text-shadow: 0 0 10px var(--cyan);
      z-index: 2;
    }
    .balance-label {
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 2px;
      margin-top: -5px;
      z-index: 2;
    }

    /* --- 歷史紀錄：數據流風格 --- */
    .history-box {
      margin-top: 30px;
      text-align: left;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 15px 20px;
      border-left: 2px solid var(--purple);
    }
    .history-title {
      font-size: 10px;
      color: var(--purple);
      margin-bottom: 10px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .log-item {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: #d1d5db;
    }
    .log-time { font-family: monospace; color: var(--cyan); opacity: 0.8; }
    
    .btn-logout {
      background: none; border: none; color: var(--text-dim);
      margin-top: 25px; font-size: 12px; cursor: pointer;
      text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
    }
    .btn-logout:hover { color: #fff; text-shadow: 0 0 5px #fff; }

    .hidden { display: none; }

    /* SweetAlert 未來感客製化 */
    div:where(.swal2-container) div:where(.swal2-popup) {
      background: #0a0c10 !important;
      border: 1px solid var(--cyan);
      box-shadow: 0 0 30px rgba(0, 243, 255, 0.15);
      border-radius: 16px !important;
    }
    div:where(.swal2-container) h2:where(.swal2-title) { color: #fff !important; font-family: 'Exo 2' !important; }
    div:where(.swal2-container) div:where(.swal2-html-container) { color: #aaa !important; }
    div:where(.swal2-container) button:where(.swal2-confirm) {
      background: var(--cyan) !important; color: #000 !important; font-weight: bold;
      box-shadow: 0 0 15px var(--cyan) !important;
    }
    div:where(.swal2-container) button:where(.swal2-cancel) {
      background: transparent !important; border: 1px solid #555 !important; color: #fff !important;
    }
  </style>
</head>
<body>

  <div id="loginView" class="card">
    <div style="font-size: 40px; margin-bottom: 15px; text-shadow: 0 0 20px var(--cyan);">⌘</div>
    <h1>NEXUS SYSTEM</h1>
    <div class="sub-text">IDENTITY VERIFICATION</div>
    
    <input type="text" id="nameInput" placeholder="USERNAME // 姓名">
    <input type="tel" id="passInput" placeholder="PASSWORD // 密碼">
    
    <button class="btn btn-main" onclick="processLogin()">LOGIN 登入系統</button>
  </div>

  <div id="mainView" class="card hidden">
    <h1 id="welcomeName" style="font-size: 22px;">COMMANDER</h1>
    <div class="sub-text">SYSTEM ONLINE</div>
    
    <div class="holo-ring">
      <div class="balance-num" id="balanceDisplay">--</div>
      <div class="balance-label">CREDITS</div>
    </div>

    <button class="btn btn-action" onclick="processCheckIn()">
      INITIATE CHECK-IN // 執行簽到
    </button>

    <div class="history-box">
      <div class="history-title">DATA LOGS_</div>
      <div id="historyList">
        <p style="color:var(--text-dim); font-size:12px; font-family:monospace;">> WAITING FOR DATA...</p>
      </div>
    </div>

    <button class="btn-logout" onclick="logout()">[ TERMINATE SESSION / 登出 ]</button>
  </div>

  <script>
    // ★★★ 您的專屬 API 網址 (已自動填入) ★★★
    const API_URL = "https://script.google.com/macros/s/AKfycbzMW46rexrt4rQmQuRxevV99RyvNZgwQi09GLP_8aVHXXjZDVNWeoqpP5NtfsbOoRsUcA/exec"; 

    // 1. 自動登入
    window.onload = function() {
      const savedName = localStorage.getItem("tt_name");
      const savedPass = localStorage.getItem("tt_pass");
      if (savedName && savedPass) {
        document.getElementById('nameInput').value = savedName;
        document.getElementById('passInput').value = savedPass;
        processLogin(true); 
      }
    };

    // 2. 登入邏輯
    function processLogin(isAuto = false) {
      const name = document.getElementById('nameInput').value.trim();
      const pass = document.getElementById('passInput').value.trim();

      if (!name || !pass) return Swal.fire({title:'ACCESS DENIED', text:'請輸入完整帳號密碼', icon:'warning'});
      
      if (!isAuto) {
        Swal.fire({ 
          title: 'CONNECTING...', 
          html: '正在建立加密連線',
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
          background: '#050505'
        });
      }

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: 'login', name: name, password: pass }),
        headers: { "Content-Type": "text/plain" }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          localStorage.setItem("tt_name", name);
          localStorage.setItem("tt_pass", pass);
          updateUI(name, data.balance, data.history);
          
          document.getElementById('loginView').classList.add('hidden');
          document.getElementById('mainView').classList.remove('hidden');
          Swal.close();
        } else {
          if (isAuto) logout(); 
          else Swal.fire({title:'LOGIN FAILED', text: data.msg || '身分驗證失敗', icon:'error'});
        }
      })
      .catch(err => Swal.fire({title:'SYSTEM ERROR', text:'伺服器無回應', icon:'error'}));
    }

    // 3. 簽到邏輯
    function processCheckIn() {
      const name = localStorage.getItem("tt_name");
      const pass = localStorage.getItem("tt_pass");

      Swal.fire({
        title: 'EXECUTE?',
        text: "將扣除 1 點額度",
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'CONFIRM',
        cancelButtonText: 'ABORT'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({ title: 'PROCESSING...', didOpen: () => Swal.showLoading(), background: '#050505' });
          
          fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ action: 'checkin', name: name, password: pass }),
            headers: { "Content-Type": "text/plain" }
          })
          .then(res => res.json())
          .then(data => {
            if (data.status !== 'error') {
              if(data.status === 'fail') {
                 Swal.fire({title:'INSUFFICIENT FUNDS', text:data.msg, icon:'warning'});
              } else {
                 Swal.fire({title:'SUCCESS', text:'簽到程序完成', icon:'success'});
              }
              updateUI(name, data.balance, data.history);
            } else {
              Swal.fire({title:'ERROR', text:data.msg, icon:'error'});
            }
          });
        }
      });
    }

    // 4. 更新畫面
    function updateUI(name, balance, history) {
      document.getElementById('welcomeName').innerText = name; // 顯示大名
      document.getElementById('balanceDisplay').innerText = balance;
      
      const list = document.getElementById('historyList');
      list.innerHTML = ""; 
      
      if(history && history.length > 0) {
        history.forEach(log => {
          list.innerHTML += `
            <div class="log-item">
              <span class="log-time">${log.time}</span>
              <span class="log-action">${log.action}</span>
            </div>`;
        });
      } else {
        list.innerHTML = "<p style='color:var(--text-dim); font-size:12px; font-family:monospace;'>> NO RECORDS FOUND</p>";
      }
    }

    // 5. 登出
    function logout() {
      localStorage.removeItem("tt_name");
      localStorage.removeItem("tt_pass");
      location.reload();
    }
  </script>
</body>
</html>
