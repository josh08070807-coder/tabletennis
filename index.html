<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Q-Pong æ¡Œçƒå°å¹«æ‰‹</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    /* --- Qç‰ˆç§‘æŠ€è—ä¸»é¡Œè¨­å®š --- */
    :root {
      --primary-blue: #4facfe;
      --secondary-blue: #00f2fe;
      --accent-color: #ff9a9e;
      --text-color: #5b6b8a;
      --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }

    body {
      font-family: 'Nunito', sans-serif; /* åœ“æ½¤å­—é«” */
      background-color: #a1c4fd;
      /* èƒŒæ™¯ï¼šæŸ”å’Œçš„è—è‰²æ¼¸å±¤ */
      background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: var(--text-color);
      overflow: hidden; /* é˜²æ­¢æ³¡æ³¡è¶…å‡º */
    }

    /* èƒŒæ™¯é£„æµ®æ³¡æ³¡å‹•ç•« (è£é£¾ç”¨) */
    .bubble {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      z-index: -1;
      animation: float 10s infinite ease-in-out;
    }
    .b1 { width: 100px; height: 100px; top: 10%; left: 10%; animation-duration: 8s; }
    .b2 { width: 150px; height: 150px; bottom: 15%; right: 10%; animation-duration: 12s; }
    .b3 { width: 60px; height: 60px; top: 40%; right: 30%; animation-duration: 6s; }
    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.05); }
    }

    /* --- å¡ç‰‡å®¹å™¨ (åƒé›²æœµä¸€æ¨£ç™½è»Ÿ) --- */
    .card {
      background: rgba(255, 255, 255, 0.95);
      width: 85%;
      max-width: 360px;
      padding: 40px 30px;
      border-radius: 40px; /* è¶…åœ“è§’ */
      text-align: center;
      box-shadow: 
        0 20px 50px rgba(79, 172, 254, 0.2), 
        0 5px 15px rgba(0,0,0,0.05);
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease;
      position: relative;
      z-index: 10;
    }
    /* å¡ç‰‡å¾®å¾®æµ®å‹•æ•ˆæœ */
    .card:hover { transform: translateY(-5px); }

    h1 {
      margin: 0 0 10px;
      color: #3b4d61;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: 1px;
    }
    
    .sub-text { font-size: 14px; color: #8fa1b3; margin-bottom: 25px; font-weight: 700;}

    /* Qç‰ˆåœ–ç¤º */
    .icon-area {
      font-size: 60px;
      margin-bottom: 10px;
      filter: drop-shadow(0 5px 10px rgba(79, 172, 254, 0.3));
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* --- è¼¸å…¥æ¡† (è† å›Šå‹) --- */
    input {
      width: 100%;
      padding: 18px;
      font-size: 16px;
      font-family: 'Nunito', sans-serif;
      font-weight: 700;
      border: 2px solid #edf2f7;
      border-radius: 50px; /* è† å›Šå½¢ç‹€ */
      box-sizing: border-box;
      outline: none;
      margin-bottom: 15px;
      text-align: center;
      background: #f7f9fc;
      color: #5b6b8a;
      transition: 0.3s;
    }
    input::placeholder { color: #cbd5e0; }
    input:focus {
      border-color: var(--primary-blue);
      background: #fff;
      box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.1);
    }

    /* --- æŒ‰éˆ• (æœå‡è³ªæ„Ÿ) --- */
    .btn {
      width: 100%;
      padding: 18px;
      font-size: 18px;
      font-weight: 900;
      color: white;
      border: none;
      border-radius: 50px; /* è† å›Šå½¢ç‹€ */
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      margin-top: 10px;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    /* è—è‰²æ¼¸å±¤æŒ‰éˆ• */
    .btn-blue {
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
    }
    .btn-blue:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(79, 172, 254, 0.4); }
    .btn-blue:active { transform: scale(0.95); }

    /* ç¶ è‰²æ¼¸å±¤æŒ‰éˆ• */
    .btn-green {
      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      box-shadow: 0 10px 20px rgba(67, 233, 123, 0.3);
    }
    .btn-green:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(67, 233, 123, 0.4); }
    .btn-green:active { transform: scale(0.95); }

    /* --- æœå‡èƒ½é‡çƒ (é¤˜é¡é¡¯ç¤º) --- */
    .jelly-ball {
      width: 130px;
      height: 130px;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 20px auto;
      color: white;
      box-shadow: 
        inset -10px -10px 20px rgba(0,0,0,0.1),
        inset 10px 10px 20px rgba(255,255,255,0.4),
        0 15px 30px rgba(79, 172, 254, 0.4);
      animation: pulse 3s infinite ease-in-out;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .balance-num { font-size: 52px; font-weight: 900; line-height: 1; }
    .balance-label { font-size: 13px; font-weight: 700; opacity: 0.9; margin-top: 5px; }

    /* --- æ­·å²ç´€éŒ„ (æ°£æ³¡æ¡†é¢¨æ ¼) --- */
    .history-box {
      text-align: left;
      margin-top: 25px;
      background: #f7f9fc;
      border-radius: 20px;
      padding: 15px 20px;
    }
    .history-title {
      font-size: 13px;
      color: #8fa1b3;
      margin-bottom: 10px;
      font-weight: 800;
      text-transform: uppercase;
    }
    .log-item {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      padding: 8px 0;
      border-bottom: 2px solid #edf2f7;
      color: #5b6b8a;
      font-weight: 700;
    }
    .log-item:last-child { border-bottom: none; }
    .log-time { color: #a1c4fd; font-size: 12px; }

    .btn-logout {
      background: none; border: none; 
      color: #cbd5e0; 
      margin-top: 20px; font-size: 13px; cursor: pointer;
      font-weight: 700; transition: 0.3s;
    }
    .btn-logout:hover { color: #ff9a9e; }

    .hidden { display: none; }

    /* SweetAlert Qç‰ˆæ¨£å¼ä¿®æ­£ */
    div:where(.swal2-container) div:where(.swal2-popup) {
      border-radius: 30px !important;
      font-family: 'Nunito', sans-serif !important;
    }
    div:where(.swal2-container) button:where(.swal2-styled) {
      border-radius: 20px !important;
    }
  </style>
</head>
<body>

  <div class="bubble b1"></div>
  <div class="bubble b2"></div>
  <div class="bubble b3"></div>

  <div id="loginView" class="card">
    <div class="icon-area">ğŸ“</div>
    <h1>æ¡Œçƒå°å¹«æ‰‹</h1>
    <p class="sub-text">Hiï¼ä»Šå¤©ä¹Ÿä¾†ç·´çƒå—ï¼Ÿ</p>
    
    <input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥åå­—">
    <input type="tel" id="passInput" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    
    <button class="btn btn-blue" onclick="processLogin()">ç™»å…¥æŸ¥è©¢</button>
  </div>

  <div id="mainView" class="card hidden">
    <h1 id="welcomeName" style="font-size: 24px;">æ­¡è¿å›ä¾†</h1>
    <p class="sub-text" style="margin-bottom: 10px;">æ‚¨çš„ç›®å‰ç‹€æ…‹</p>
    
    <div class="jelly-ball">
      <div class="balance-num" id="balanceDisplay">--</div>
      <div class="balance-label">å‰©é¤˜æ¬¡æ•¸</div>
    </div>

    <button class="btn btn-green" onclick="processCheckIn()">
      âœ¨ æˆ‘è¦ç°½åˆ°
    </button>

    <div class="history-box">
      <div class="history-title">æœ€è¿‘çš„ç´€éŒ„</div>
      <div id="historyList">
        <p style="color:#cbd5e0; font-size:12px; text-align:center;">è®€å–ä¸­...</p>
      </div>
    </div>

    <button class="btn-logout" onclick="logout()">åˆ‡æ›å¸³è™Ÿ</button>
  </div>

  <script>
    // â˜…â˜…â˜… æ‚¨çš„å°ˆå±¬ API ç¶²å€ (å·²è‡ªå‹•å¡«å…¥) â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbzMW46rexrt4rQmQuRxevV99RyvNZgwQi09GLP_8aVHXXjZDVNWeoqpP5NtfsbOoRsUcA/exec"; 

    // 1. è‡ªå‹•ç™»å…¥
    window.onload = function() {
      const savedName = localStorage.getItem("tt_name");
      const savedPass = localStorage.getItem("tt_pass");
      if (savedName && savedPass) {
        document.getElementById('nameInput').value = savedName;
        document.getElementById('passInput').value = savedPass;
        processLogin(true); 
      }
    };

    // 2. ç™»å…¥é‚è¼¯
    function processLogin(isAuto = false) {
      const name = document.getElementById('nameInput').value.trim();
      const pass = document.getElementById('passInput').value.trim();

      if (!name || !pass) return Swal.fire({title:'å“å‘€', text:'è¨˜å¾—è¼¸å…¥å¸³è™Ÿå¯†ç¢¼å–”ï¼', icon:'info', confirmButtonColor:'#4facfe'});
      
      if (!isAuto) {
        Swal.fire({ 
          title: 'è®€å–ä¸­...', 
          html: 'æ­£åœ¨æ‰¾å°‹æ‚¨çš„è³‡æ–™',
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading()
        });
      }

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: 'login', name: name, password: pass }),
        headers: { "Content-Type": "text/plain" }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          localStorage.setItem("tt_name", name);
          localStorage.setItem("tt_pass", pass);
          updateUI(name, data.balance, data.history);
          
          document.getElementById('loginView').classList.add('hidden');
          document.getElementById('mainView').classList.remove('hidden');
          Swal.close();
        } else {
          if (isAuto) logout(); 
          else Swal.fire({title:'ç™»å…¥å¤±æ•—', text: data.msg || 'åå­—æˆ–å¯†ç¢¼ä¸å°å–”', icon:'error', confirmButtonColor:'#ff9a9e'});
        }
      })
      .catch(err => Swal.fire({title:'é€£ç·šéŒ¯èª¤', text:'ç¶²è·¯å¥½åƒæœ‰é»å•é¡Œ', icon:'error'}));
    }

    // 3. ç°½åˆ°é‚è¼¯
    function processCheckIn() {
      const name = localStorage.getItem("tt_name");
      const pass = localStorage.getItem("tt_pass");

      Swal.fire({
        title: 'ç¢ºå®šç°½åˆ°å—ï¼Ÿ',
        text: "æœƒæ‰£æ‰ 1 æ¬¡ä¸Šèª²æ¬¡æ•¸å–”ï¼",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#43e97b',
        cancelButtonColor: '#ff9a9e',
        confirmButtonText: 'æ²’å•é¡Œï¼',
        cancelButtonText: 'ç­‰ä¸€ä¸‹'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({ title: 'ç´€éŒ„ä¸­...', didOpen: () => Swal.showLoading() });
          
          fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ action: 'checkin', name: name, password: pass }),
            headers: { "Content-Type": "text/plain" }
          })
          .then(res => res.json())
          .then(data => {
            if (data.status !== 'error') {
              if(data.status === 'fail') {
                 Swal.fire({title:'æ¬¡æ•¸ä¸å¤ å›‰', text:data.msg, icon:'warning', confirmButtonColor:'#ff9a9e'});
              } else {
                 Swal.fire({title:'ç°½åˆ°æˆåŠŸï¼', text:'ç¥æ‚¨ç·´çƒæ„‰å¿«ï½', icon:'success', confirmButtonColor:'#43e97b'});
              }
              updateUI(name, data.balance, data.history);
            } else {
              Swal.fire({title:'å¤±æ•—', text:data.msg, icon:'error', confirmButtonColor:'#ff9a9e'});
            }
          });
        }
      });
    }

    // 4. æ›´æ–°ç•«é¢
    function updateUI(name, balance, history) {
      document.getElementById('welcomeName').innerText = "å—¨ï¼Œ" + name;
      document.getElementById('balanceDisplay').innerText = balance;
      
      const list = document.getElementById('historyList');
      list.innerHTML = ""; 
      
      if(history && history.length > 0) {
        history.forEach(log => {
          list.innerHTML += `
            <div class="log-item">
              <span class="log-time">${log.time}</span>
              <span class="log-action">${log.action}</span>
            </div>`;
        });
      } else {
        list.innerHTML = "<p style='color:#cbd5e0; font-size:12px; text-align:center;'>é‚„æ²’æœ‰ç´€éŒ„å–”</p>";
      }
    }

    // 5. ç™»å‡º
    function logout() {
      localStorage.removeItem("tt_name");
      localStorage.removeItem("tt_pass");
      location.reload();
    }
  </script>
</body>
</html>
