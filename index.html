<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NEXUS æ¡Œçƒç«¶æŠ€ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Teko:wght@300;600&display=swap" rel="stylesheet">

  <style>
    /* --- NEXT-GEN UI è¨­å®š --- */
    :root {
      --cyan: #00f3ff;
      --purple: #bc13fe;
      --dark-bg: #050505;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-main: #ffffff;
      --text-dim: #8b9bb4;
    }

    body {
      font-family: 'Exo 2', sans-serif;
      background-color: var(--dark-bg);
      /* èƒŒæ™¯ï¼šåŠ å…¥æ•¸ä½å…­è§’ç¶²æ ¼ (æ¨¡æ“¬ç§‘æŠ€çƒç¶²) + æ·±ç©ºæ¼¸å±¤ */
      background-image: 
        linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px),
        radial-gradient(circle at 50% 0%, rgba(188, 19, 254, 0.2) 0%, transparent 60%),
        radial-gradient(circle at 0% 100%, rgba(0, 243, 255, 0.15) 0%, transparent 60%);
      background-size: 30px 30px, 30px 30px, 100% 100%, 100% 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: var(--text-main);
      overflow: hidden;
    }

    /* --- ä¸»å¡ç‰‡ï¼šç»ç’ƒæ“¬æ…‹ --- */
    .card {
      background: var(--glass-bg);
      width: 85%;
      max-width: 380px;
      padding: 40px 30px;
      border-radius: 24px;
      text-align: center;
      border: 1px solid var(--glass-border);
      box-shadow: 
        0 30px 60px rgba(0, 0, 0, 0.6),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(25px);
      position: relative;
      overflow: hidden;
    }

    /* å¡ç‰‡é ‚éƒ¨å…‰æ¢ */
    .card::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--purple), var(--cyan));
      box-shadow: 0 0 20px var(--cyan);
    }

    /* ç§‘æŠ€æ„Ÿçƒæ‹åœ–ç¤º */
    .racket-icon {
      font-size: 48px;
      margin-bottom: 10px;
      display: inline-block;
      text-shadow: 0 0 15px var(--cyan), 0 0 30px var(--purple);
      animation: pulseIcon 2s infinite alternate;
    }
    @keyframes pulseIcon { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); } }

    h1 {
      margin: 0 0 5px; font-weight: 700; font-size: 26px; letter-spacing: 2px;
      background: linear-gradient(90deg, #fff, var(--cyan));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }

    .sub-text {
      color: var(--text-dim); font-size: 12px; letter-spacing: 4px;
      text-transform: uppercase; margin-bottom: 30px;
      border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; display: inline-block;
    }

    /* --- è¼¸å…¥æ¡† --- */
    input {
      width: 100%; padding: 16px; font-size: 18px; font-family: 'Exo 2', sans-serif;
      color: var(--cyan); background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 243, 255, 0.3); border-radius: 8px;
      box-sizing: border-box; outline: none; margin-bottom: 15px;
      text-align: center; transition: 0.3s; letter-spacing: 1px;
    }
    input::placeholder { color: rgba(255, 255, 255, 0.2); letter-spacing: 0; }
    input:focus { border-color: var(--cyan); box-shadow: 0 0 20px rgba(0, 243, 255, 0.3); background: rgba(0, 0, 0, 0.5); }

    /* --- æŒ‰éˆ• --- */
    .btn {
      width: 100%; padding: 18px; font-size: 18px; font-weight: 700; color: white;
      border: none; border-radius: 8px; cursor: pointer; font-family: 'Exo 2', sans-serif;
      text-transform: uppercase; letter-spacing: 2px; margin-top: 15px;
      position: relative; overflow: hidden; transition: all 0.3s;
    }
    .btn-main {
      background: linear-gradient(135deg, var(--purple), #0062ff);
      box-shadow: 0 0 25px rgba(188, 19, 254, 0.4);
    }
    .btn-main:hover { box-shadow: 0 0 40px rgba(188, 19, 254, 0.7); transform: translateY(-2px); }

    .btn-action {
      background: transparent; border: 1px solid var(--cyan); color: var(--cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
    }
    .btn-action:hover { background: var(--cyan); color: #000; box-shadow: 0 0 40px rgba(0, 243, 255, 0.7); }

    /* --- æ ¸å¿ƒï¼šå…¨åƒæŠ•å½±ä¹’ä¹“çƒ (Holo-Ball) --- */
    .holo-ball {
      width: 160px; height: 160px; margin: 30px auto;
      position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column;
      border-radius: 50%;
      /* çƒé«”åŸºç¤ç™¼å…‰ */
      background: radial-gradient(circle at 30% 30%, rgba(0, 243, 255, 0.8), rgba(0, 243, 255, 0.1) 60%, transparent 70%);
      box-shadow: 0 0 50px rgba(0, 243, 255, 0.5), inset 0 0 20px rgba(0, 243, 255, 0.5);
      overflow: hidden;
    }
    
    /* çƒé«”è¡¨é¢çš„æ—‹è½‰æ•¸ä½ç¶²æ ¼ */
    .holo-ball::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; width: 200%; height: 200%;
      background: 
        linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 15px 15px; /* ç¶²æ ¼å¤§å° */
      border-radius: 50%;
      animation: spinBall 5s linear infinite;
      opacity: 0.6;
      mask-image: radial-gradient(circle, black 40%, transparent 70%); /* è®“ç¶²æ ¼åªåœ¨çƒé«”ä¸­é–“æ¸…æ™° */
    }

    @keyframes spinBall { 
      0% { transform: rotate(0deg) scale(1); } 
      50% { transform: rotate(180deg) scale(1.1); } /* å¾®å¾®å‘¼å¸æ•ˆæœ */
      100% { transform: rotate(360deg) scale(1); } 
    }

    .balance-num {
      font-family: 'Teko', sans-serif; font-size: 72px; line-height: 1; color: #fff;
      text-shadow: 0 0 15px var(--cyan); z-index: 2;
    }
    .balance-label {
      font-size: 12px; color: rgba(255,255,255,0.7); letter-spacing: 2px;
      margin-top: -5px; z-index: 2; text-transform: uppercase;
    }

    /* --- æ­·å²ç´€éŒ„ --- */
    .history-box {
      margin-top: 30px; text-align: left; background: rgba(0, 0, 0, 0.3);
      border-radius: 12px; padding: 15px 20px; border-left: 3px solid var(--purple);
    }
    .history-title {
      font-size: 11px; color: var(--purple); margin-bottom: 10px; font-weight: 700;
      letter-spacing: 1px; text-transform: uppercase;
    }
    .log-item {
      display: flex; justify-content: space-between; font-size: 14px; padding: 8px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.1); color: #d1d5db;
    }
    .log-time { font-family: monospace; color: var(--cyan); opacity: 0.9; }
    
    .btn-logout {
      background: none; border: none; color: var(--text-dim); margin-top: 25px;
      font-size: 12px; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
    }
    .btn-logout:hover { color: #fff; text-shadow: 0 0 10px var(--cyan); }

    .hidden { display: none; }

    /* SweetAlert ç¾åŒ– */
    div:where(.swal2-container) div:where(.swal2-popup) {
      background: #0a0c10 !important; border: 1px solid var(--cyan);
      box-shadow: 0 0 40px rgba(0, 243, 255, 0.2); border-radius: 16px !important;
    }
    div:where(.swal2-container) h2:where(.swal2-title) { color: #fff !important; font-family: 'Exo 2' !important; }
    div:where(.swal2-container) div:where(.swal2-html-container) { color: #aaa !important; }
    div:where(.swal2-container) button:where(.swal2-confirm) {
      background: var(--cyan) !important; color: #000 !important; font-weight: bold; box-shadow: 0 0 20px var(--cyan) !important;
    }
  </style>
</head>
<body>

  <div id="loginView" class="card">
    <div class="racket-icon">ğŸ“</div>
    <h1>NEXUS TABLE TENNIS</h1>
    <div class="sub-text">PLAYER AUTHENTICATION</div>
    
    <input type="text" id="nameInput" placeholder="USERNAME // å§“å">
    <input type="tel" id="passInput" placeholder="PASSWORD // å¯†ç¢¼">
    
    <button class="btn btn-main" onclick="processLogin()">PLAYER LOGIN / ç™»å…¥</button>
  </div>

  <div id="mainView" class="card hidden">
    <h1 id="welcomeName" style="font-size: 22px;">PLAYER 1</h1>
    <div class="sub-text">ARENA CONNECTED</div>
    
    <div class="holo-ball">
      <div class="balance-num" id="balanceDisplay">--</div>
      <div class="balance-label">MATCH CREDITS</div>
    </div>

    <button class="btn btn-action" onclick="processCheckIn()">
      EXECUTE SERVE // åŸ·è¡Œç™¼çƒ(ç°½åˆ°)
    </button>

    <div class="history-box">
      <div class="history-title">MATCH LOGS_</div>
      <div id="historyList">
        <p style="color:var(--text-dim); font-size:12px; font-family:monospace;">> WAITING FOR SYNC...</p>
      </div>
    </div>

    <button class="btn-logout" onclick="logout()">[ DISCONNECT / ç™»å‡º ]</button>
  </div>

  <script>
    // â˜…â˜…â˜… æ‚¨çš„å°ˆå±¬ API ç¶²å€ (å·²è‡ªå‹•å¡«å…¥) â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbzMW46rexrt4rQmQuRxevV99RyvNZgwQi09GLP_8aVHXXjZDVNWeoqpP5NtfsbOoRsUcA/exec"; 

    // 1. è‡ªå‹•ç™»å…¥
    window.onload = function() {
      const savedName = localStorage.getItem("tt_name");
      const savedPass = localStorage.getItem("tt_pass");
      if (savedName && savedPass) {
        document.getElementById('nameInput').value = savedName;
        document.getElementById('passInput').value = savedPass;
        processLogin(true); 
      }
    };

    // 2. ç™»å…¥é‚è¼¯
    function processLogin(isAuto = false) {
      const name = document.getElementById('nameInput').value.trim();
      const pass = document.getElementById('passInput').value.trim();

      if (!name || !pass) return Swal.fire({title:'ACCESS DENIED', text:'è«‹è¼¸å…¥å®Œæ•´å¸³è™Ÿå¯†ç¢¼', icon:'warning'});
      
      if (!isAuto) {
        Swal.fire({ 
          title: 'CONNECTING...', 
          html: 'æ­£åœ¨é€£ç·šè‡³çƒå ´æ•¸æ“šåº«',
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
          background: '#050505'
        });
      }

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: 'login', name: name, password: pass }),
        headers: { "Content-Type": "text/plain" }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          localStorage.setItem("tt_name", name);
          localStorage.setItem("tt_pass", pass);
          updateUI(name, data.balance, data.history);
          
          document.getElementById('loginView').classList.add('hidden');
          document.getElementById('mainView').classList.remove('hidden');
          Swal.close();
        } else {
          if (isAuto) logout(); 
          else Swal.fire({title:'LOGIN FAILED', text: data.msg || 'èº«åˆ†é©—è­‰å¤±æ•—', icon:'error'});
        }
      })
      .catch(err => Swal.fire({title:'SYSTEM ERROR', text:'ä¼ºæœå™¨ç„¡å›æ‡‰', icon:'error'}));
    }

    // 3. ç°½åˆ°é‚è¼¯
    function processCheckIn() {
      const name = localStorage.getItem("tt_name");
      const pass = localStorage.getItem("tt_pass");

      Swal.fire({
        title: 'CONFIRM SERVE?',
        text: "å°‡æ‰£é™¤ 1 å ´æ¯”è³½é¡åº¦",
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'EXECUTE',
        cancelButtonText: 'ABORT'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({ title: 'PROCESSING...', html:'æ­£åœ¨æ›´æ–°æ¯”è³½æ•¸æ“š...', didOpen: () => Swal.showLoading(), background: '#050505' });
          
          fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ action: 'checkin', name: name, password: pass }),
            headers: { "Content-Type": "text/plain" }
          })
          .then(res => res.json())
          .then(data => {
            if (data.status !== 'error') {
              if(data.status === 'fail') {
                 Swal.fire({title:'INSUFFICIENT CREDITS', text:data.msg, icon:'warning'});
              } else {
                 Swal.fire({title:'SERVE COMPLETE', text:'ç°½åˆ°å®Œæˆï¼Œæ¯”è³½é–‹å§‹', icon:'success'});
              }
              updateUI(name, data.balance, data.history);
            } else {
              Swal.fire({title:'ERROR', text:data.msg, icon:'error'});
            }
          });
        }
      });
    }

    // 4. æ›´æ–°ç•«é¢
    function updateUI(name, balance, history) {
      document.getElementById('welcomeName').innerText = name;
      document.getElementById('balanceDisplay').innerText = balance;
      
      const list = document.getElementById('historyList');
      list.innerHTML = ""; 
      
      if(history && history.length > 0) {
        history.forEach(log => {
          list.innerHTML += `
            <div class="log-item">
              <span class="log-time">${log.time}</span>
              <span class="log-action">${log.action}</span>
            </div>`;
        });
      } else {
        list.innerHTML = "<p style='color:var(--text-dim); font-size:12px; font-family:monospace;'>> NO MATCH RECORDS</p>";
      }
    }

    // 5. ç™»å‡º
    function logout() {
      localStorage.removeItem("tt_name");
      localStorage.removeItem("tt_pass");
      location.reload();
    }
  </script>
</body>
</html>
